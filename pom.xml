<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  
  <parent>
  	<groupId>de.gebit.maven</groupId>
  	<artifactId>gebit-poms</artifactId>
  	<version>0.0.1</version>
  </parent>
  
  <groupId>de.gebit.integrity</groupId>
  <artifactId>integrity</artifactId>
  <version>${integrity-version}</version>
  <name>Integrity Main Build</name>
  <packaging>pom</packaging>
  
  <scm>
  	<developerConnection>scm:git:ssh://ci@gebit-git/var/lib/git/integrity.git</developerConnection>
  </scm>
  
  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <tycho-version>0.14.0</tycho-version>
    <integrity-version>0.6.3-SNAPSHOT</integrity-version>
    
    <isRelease>false</isRelease>
  </properties>
  
  <profiles>
    <profile>
      <id>release-deploy-property-override</id>
      <activation>
        <property>
          <name>integrity-version</name>
        </property>
      </activation>
      <properties>
        <isRelease>true</isRelease>
      </properties>
    </profile>
  </profiles>
  
  <modules>
  	<module>targetplatform</module>
    <module>de.gebit.integrity.dsl</module>
    <module>de.gebit.integrity.dsl.ui</module>
    <module>de.gebit.integrity.eclipse</module>
    <module>de.gebit.integrity.remoting</module>
    <module>de.gebit.integrity.runner</module>
    <module>de.gebit.integrity.feature</module>
    <module>de.gebit.integrity.tests</module>
    <module>distribution</module>
    <module>standalonedeps.indigo</module>
    <module>updatesite</module>
  </modules>
  
  <build>
    <plugins>
      
		  <plugin>
		    <groupId>org.eclipse.tycho</groupId>
		    <artifactId>tycho-maven-plugin</artifactId>
		    <extensions>true</extensions>
		    <version>${tycho-version}</version>
		  </plugin>
		  
		  <plugin>
		    <groupId>org.eclipse.tycho</groupId>
		    <artifactId>target-platform-configuration</artifactId>
		    <version>${tycho-version}</version>
			<configuration>
			  <resolver>p2</resolver>
			  <target>
			    <artifact>
			      <groupId>de.gebit.integrity</groupId>
			      <artifactId>integrity-target</artifactId>
			      <version>${project.version}</version>
			      <classifier>indigo</classifier>
			    </artifact>
			  </target>
			  <ignoreTychoRepositories>true</ignoreTychoRepositories>
			  <environments>
			  	<environment>
					<os>win32</os>
					<ws>win32</ws>
					<arch>x86_64</arch>
				</environment>
			  </environments>
			</configuration>
		  </plugin>
		  
	      <plugin>
	        <groupId>org.apache.maven.plugins</groupId>
	        <artifactId>maven-checkstyle-plugin</artifactId>
	        <version>2.9.1</version>
	        <configuration>
	          <configLocation>${basedir}/../build/checkstyle/checkstyle-code-style.xml</configLocation>
	          <sourceDirectory>${basedir}/src</sourceDirectory>
	       	  <headerLocation>${basedir}/../build/checkstyle/license.txt</headerLocation>
	       	  <propertyExpansion>samedir=${basedir}/../build/checkstyle/</propertyExpansion>
	        </configuration>
<!-- 	        <executions> -->
<!-- 				<execution> -->
<!-- 				  <id>default-checkstyle</id> -->
<!-- 				  <phase>test</phase> -->
<!-- 				  <goals> -->
<!-- 				    <goal>checkstyle</goal> -->
<!-- 				  </goals> -->
<!-- 				</execution> -->
<!-- 	          </executions> -->
	      </plugin>
	      
	      <plugin>
	        <groupId>org.apache.maven.plugins</groupId>
	        <artifactId>maven-javadoc-plugin</artifactId>
	        <version>2.8</version>
	      </plugin>
	      
	      <plugin>
	        <groupId>org.apache.maven.plugins</groupId>
	        <artifactId>maven-source-plugin</artifactId>
	        <version>2.1.2</version>
	      </plugin>
	      
	      <plugin>
	      <artifactId>maven-resources-plugin</artifactId>
	        <version>2.4.3</version>
	        <executions>
	          <execution>
	            <id>replace-pom-placeholder</id>
	            <phase>package</phase>
	            <goals>
	              <goal>copy-resources</goal>
	            </goals>
	            <configuration>
	              <resources>
	                <resource>
	                  <directory>${basedir}</directory>
	                  <includes>
	                    <include>pom.xml</include>
	                  </includes>
	                  <filtering>true</filtering>
	                </resource>
	              </resources>
	              <outputDirectory>${project.build.directory}/pom-install-deploy-fix</outputDirectory>
	            </configuration>
	          </execution>
	        </executions>
	      </plugin>
 
	      <plugin>
	        <artifactId>maven-install-plugin</artifactId>
	        <version>2.3.1</version>
	        <executions>
	          <execution>
	            <id>overwrite-pom</id>
	            <phase>install</phase>
	            <goals>
	              <goal>install-file</goal>
	            </goals>
	            <configuration>
	              <packaging>pom</packaging>
	              <file>target/pom-install-deploy-fix/pom.xml</file>
	              <pomFile>target/pom-install-deploy-fix/pom.xml</pomFile>
	              <version>${project.version}</version>
	            </configuration>
	          </execution>
	        </executions>
	      </plugin>
	 
	      <plugin>
	        <artifactId>maven-deploy-plugin</artifactId>
	        <version>2.7</version>
	        <executions>
	          <execution>
	            <id>overwrite-pom</id>
	            <phase>deploy</phase>
	            <goals>
	              <goal>deploy-file</goal>
	            </goals>
	            <configuration>
	              <packaging>pom</packaging>
	              <file>target/pom-install-deploy-fix/pom.xml</file>
	              <pomFile>target/pom-install-deploy-fix/pom.xml</pomFile>
	              <version>${project.version}</version>
	              <updateReleaseInfo>${isRelease}</updateReleaseInfo>
	              <uniqueVersion>false</uniqueVersion>
	            </configuration>
	          </execution>
	        </executions>
	      </plugin>
      
    </plugins>
  </build>
</project>
